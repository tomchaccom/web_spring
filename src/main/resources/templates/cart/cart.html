<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>장바구니 - 전자기기몰</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .cart-img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 6px;
        }
    </style>
</head>

<body>

<!-- ⭐ 공통 헤더 적용 -->
<div th:replace="fragments/header :: top-utility-bar"></div>
<div th:replace="fragments/header :: navbar"></div>

<div class="container mt-5">
    <h2 class="mb-4">장바구니</h2>

    <!-- 장바구니 비어있을 때 -->
    <div th:if="${#lists.isEmpty(cartItems)}" class="text-center py-5">
        <h4 class="text-muted">장바구니가 비어 있습니다.</h4>
        <a href="/products" class="btn btn-primary mt-3">상품 보러가기</a>
    </div>

    <!-- 장바구니 목록 -->
    <div th:if="${!#lists.isEmpty(cartItems)}">

        <table class="table align-middle">
            <thead class="table-light">
            <tr>
                <th>상품</th>
                <th>상품명</th>
                <th>가격</th>
                <th>수량</th>
                <th>총합</th>
                <th></th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="item : ${cartItems}">

                <!-- 상품 이미지 -->
                <td>
                    <img th:src="@{${item.product.imageUrl}}" class="cart-img" alt="상품 이미지">
                </td>

                <!-- 상품명 -->
                <td th:text="${item.product.name}"></td>

                <!-- 가격 -->
                <td th:text="${#numbers.formatInteger(item.product.price, 3, 'COMMA')} + '원'"></td>

                <!-- 수량 조절 -->
                <td>
                    <div class="d-flex align-items-center gap-2">

                        <!-- 수량 -1 -->
                        <form th:action="@{/cart/minus/{id}(id=${item.product.id})}" method="post">
                            <button class="btn btn-outline-secondary btn-sm">-</button>
                        </form>

                        <span th:text="${item.quantity}" class="px-2 fw-bold"></span>

                        <!-- 수량 +1 -->
                        <form th:action="@{/cart/plus/{id}(id=${item.product.id})}" method="post">
                            <button class="btn btn-outline-secondary btn-sm">+</button>
                        </form>
                    </div>
                </td>

                <!-- 총합 -->
                <td class="fw-bold text-primary"
                    th:text="${#numbers.formatInteger(item.product.price * item.quantity, 3, 'COMMA')} + '원'">
                </td>

                <!-- 삭제 버튼 -->
                <td>
                    <form th:action="@{/cart/delete/{id}(id=${item.product.id})}" method="post">
                        <button class="btn btn-outline-danger btn-sm">삭제</button>
                    </form>
                </td>

            </tr>
            </tbody>
        </table>

        <!-- 총합 + 주문 버튼 -->
        <div class="d-flex justify-content-end align-items-center mt-4">

            <h4 class="me-4">
                총 주문 금액:
                <span class="text-danger fw-bold"
                      th:text="${#numbers.formatInteger(totalPrice, 3, 'COMMA')} + '원'"></span>
            </h4>

            <a href="/order" class="btn btn-success btn-lg">
                주문하기
            </a>
        </div>

    </div>
</div>

</body>
</html>