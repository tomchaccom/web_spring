<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>μ¥λ°”κµ¬λ‹ - μ „μκΈ°κΈ°λ°</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .cart-img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 6px;
        }
    </style>
</head>

<body>

<!-- β­ κ³µν†µ ν—¤λ” μ μ© -->
<div th:replace="fragments/header :: top-utility-bar"></div>
<div th:replace="fragments/header :: navbar"></div>

<div class="container mt-5">
    <h2 class="mb-4">μ¥λ°”κµ¬λ‹</h2>

    <!-- μ¥λ°”κµ¬λ‹ λΉ„μ–΄μμ„ λ• -->
    <div th:if="${#lists.isEmpty(cartItems)}" class="text-center py-5">
        <h4 class="text-muted">μ¥λ°”κµ¬λ‹κ°€ λΉ„μ–΄ μμµλ‹λ‹¤.</h4>
        <a href="/products" class="btn btn-primary mt-3">μƒν’ λ³΄λ¬κ°€κΈ°</a>
    </div>

    <!-- μ¥λ°”κµ¬λ‹ λ©λ΅ -->
    <div th:if="${!#lists.isEmpty(cartItems)}">

        <table class="table align-middle">
            <thead class="table-light">
            <tr>
                <th>μƒν’</th>
                <th>μƒν’λ…</th>
                <th>κ°€κ²©</th>
                <th>μλ‰</th>
                <th>μ΄ν•©</th>
                <th></th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="item : ${cartItems}">

                <!-- μƒν’ μ΄λ―Έμ§€ -->
                <td>
                    <img th:src="@{${item.product.imageUrl}}" class="cart-img" alt="μƒν’ μ΄λ―Έμ§€">
                </td>

                <!-- μƒν’λ… -->
                <td th:text="${item.product.name}"></td>

                <!-- κ°€κ²© -->
                <td th:text="${#numbers.formatInteger(item.product.price, 3, 'COMMA')} + 'μ›'"></td>

                <!-- μλ‰ μ΅°μ  -->
                <td>
                    <div class="d-flex align-items-center gap-2">

                        <!-- μλ‰ -1 -->
                        <form th:action="@{/cart/minus/{id}(id=${item.product.id})}" method="post">
                            <button class="btn btn-outline-secondary btn-sm">-</button>
                        </form>

                        <span th:text="${item.quantity}" class="px-2 fw-bold"></span>

                        <!-- μλ‰ +1 -->
                        <form th:action="@{/cart/plus/{id}(id=${item.product.id})}" method="post">
                            <button class="btn btn-outline-secondary btn-sm"
                                    th:disabled="${item.product.stock <= item.quantity}">
                                +
                            </button>
                        </form>

                    </div>

                    <!-- π”¥ κ°λ³„ μ¬κ³  λ¶€μ΅± λ©”μ‹μ§€ -->
                    <p th:if="${item.product.stock <= item.quantity}"
                       class="text-danger small mt-1">
                        μ¬κ³  λ¶€μ΅± β€” λ” μ΄μƒ μ¶”κ°€ν•  μ μ—†μµλ‹λ‹¤.
                    </p>

                </td>

                <!-- μ΄ν•© -->
                <td class="fw-bold text-primary"
                    th:text="${#numbers.formatInteger(item.product.price * item.quantity, 3, 'COMMA')} + 'μ›'">
                </td>

                <!-- μ‚­μ  λ²„νΌ -->
                <td>
                    <form th:action="@{/cart/delete/{id}(id=${item.product.id})}" method="post">
                        <button class="btn btn-outline-danger btn-sm">μ‚­μ </button>
                    </form>
                </td>

            </tr>
            </tbody>
        </table>

        <!-- μ΄ν•© + μ£Όλ¬Έ λ²„νΌ (μ¥λ°”κµ¬λ‹ ν•λ‹¨) -->
        <div class="d-flex justify-content-end align-items-center mt-4">

            <h4 class="me-4">
                μ΄ μ£Όλ¬Έ κΈμ•΅:
                <span class="text-danger fw-bold"
                      th:text="${#numbers.formatInteger(totalPrice, 3, 'COMMA')} + 'μ›'"></span>
            </h4>

            <!-- π”¥ μ „μ²΄ μ¬κ³  μ²΄ν¬: μ¬κ³  λ¶€μ΅± μ—†μ -->
            <a th:if="${!stockError}"
               href="/order"
               class="btn btn-success btn-lg">
                μ£Όλ¬Έν•κΈ°
            </a>

            <!-- π”¥ μ „μ²΄ μ¬κ³  μ²΄ν¬: μ¬κ³  λ¶€μ΅± μμΌλ©΄ λΉ„ν™μ„±ν™” -->
            <button th:if="${stockError}"
                    class="btn btn-secondary btn-lg"
                    disabled>
                μ¬κ³  λ¶€μ΅±μΌλ΅ μ£Όλ¬Έν•  μ μ—†μµλ‹λ‹¤.
            </button>

        </div>

    </div>
</div>

</body>
</html>
