<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>주문 내역</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="container mt-5">

<h2 class="mb-4">📦 주문 내역</h2>

<table class="table table-hover text-center align-middle">
    <thead class="table-dark">
    <tr>
        <th>주문번호</th>
        <th>주문일자</th>
        <th>상품수</th>
        <th>결제금액</th>
        <th>결제상태</th>
        <th>배송상태</th>
        <th>관리</th>
    </tr>
    </thead>

    <tbody>
    <tr th:each="order : ${orders}">
        <!-- 주문 번호 -->
        <td th:text="${order.id}"></td>

        <!-- 주문 날짜 -->
        <td th:text="${#temporals.format(order.orderDate, 'yyyy-MM-dd HH:mm')}"></td>

        <!-- 주문 상품 수 -->
        <td th:text="${order.orderItems.size()} + '개'"></td>

        <!-- 총 결제 금액 -->
        <td th:text="${#numbers.formatInteger(order.totalPrice, 3, 'COMMA')} + '원'"></td>

        <!-- 주문 상태 뱃지 -->
        <td>
    <span class="badge px-3 py-2 text-dark"
          th:class="'badge bg-' + ${order.status.badgeClass} + ' text-dark'"
          th:text="${order.status.korean}">
    </span>
        </td>

        <!-- 배송 상태 뱃지 -->
        <td>
    <span class="badge px-3 py-2 text-dark"
          th:class="'badge bg-' + ${order.delivery.state.badgeClass} + ' text-dark'"
          th:text="${order.delivery.state.korean}">
    </span>
        </td>



        <!-- 관리 버튼 -->
        <td>

            <!-- 상세보기 -->
            <a class="btn btn-sm btn-primary me-2"
               th:href="@{/order/detail/{id}(id=${order.id})}">
                상세보기
            </a>

            <!-- 주문 취소 버튼: 배송 전 상태에서만 -->
            <form th:if="${order.status == T(com.example.web_spring.Order.OrderStatus).PAYMENT_COMPLETED}"
                  th:action="@{/order/cancel/{id}(id=${order.id})}"
                  method="post" class="d-inline">
                <button class="btn btn-sm btn-danger">주문 취소</button>
            </form>

            <!-- 반품 버튼: 배송완료 상태에서만 -->
            <form th:if="${order.status == T(com.example.web_spring.Order.OrderStatus).DELIVERED}"
                  th:action="@{/order/refund/{id}(id=${order.id})}"
                  method="post" class="d-inline">
                <button class="btn btn-sm btn-warning text-white">반품</button>
            </form>

        </td>
    </tr>
    </tbody>
</table>

</body>
</html>