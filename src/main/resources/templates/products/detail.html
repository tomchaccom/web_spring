<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title th:text="${product.name}">ìƒí’ˆ ìƒì„¸</title>

  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

  <style>
    .product-image-fixed {
      width: 100%;
      height: 350px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid #ddd;
    }

    .review-delete-btn {
      border: none;
      background: #dc3545;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.8rem;
    }

    .review-delete-btn:hover {
      background: #bb2d3b;
    }
  </style>
</head>

<body class="container mt-5">

<h1 class="mb-4" th:text="${product.name}">ìƒí’ˆëª…</h1>

<div class="row">

  <!-- ìƒí’ˆ ì´ë¯¸ì§€ -->
  <div class="col-md-5">
    <img th:src="${product.imageUrl}" class="product-image-fixed" alt="ìƒí’ˆ ì´ë¯¸ì§€">
  </div>

  <!-- ìƒí’ˆ ì •ë³´ -->
  <div class="col-md-7">

    <h3 class="text-primary"
        th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')} + 'ì›'"></h3>

    <div class="mt-4">
      <h5 class="fw-bold">ìƒí’ˆ ì„¤ëª…</h5>
      <p class="border rounded p-3 bg-light" th:text="${product.description}"></p>
    </div>

    <p class="mt-3">
      <strong>ì¬ê³ :</strong>
      <span th:text="${product.stock}"></span> ê°œ
    </p>

    <p class="mt-2">
      <strong>ì¹´í…Œê³ ë¦¬:</strong>
      <span th:text="${product.category.name}"></span>
    </p>

    <!-- ë²„íŠ¼ ê·¸ë£¹ -->
    <div class="mt-4 d-flex gap-3 flex-wrap">

      <form th:action="@{/cart/add/{id}(id=${product.id})}" method="post">
        <button type="submit"
                class="btn btn-warning btn-lg text-white"
                th:disabled="${product.stock == 0}">
          ğŸ›’ ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°
        </button>
      </form>

      <p th:if="${product.stock == 0}" class="text-danger mt-2">
        í˜„ì¬ ì¬ê³ ê°€ ë¶€ì¡±í•˜ì—¬ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
      </p>

      <form th:action="@{/products/wish(id=${product.id})}" method="post">
        <button type="submit" class="btn btn-outline-danger btn-lg">
          â¤ï¸ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
        </button>
      </form>

      <a href="/wish" class="btn btn-outline-secondary btn-lg">
        ğŸ‘‰ ë‚´ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™
      </a>

      <a href="/products" class="btn btn-secondary btn-lg">
        ëª©ë¡ìœ¼ë¡œ
      </a>

    </div>
  </div>
</div>


<!-- ë¦¬ë·° ë¦¬ìŠ¤íŠ¸  -->
<div class="mt-5">
  <h3 class="mb-3">ğŸ“ ìƒí’ˆ í›„ê¸°</h3>

  <div class="list-group mb-4">

    <!-- ===== ë¦¬ë·° ë°˜ë³µë¬¸ ì‹œì‘ ===== -->
    <div class="list-group-item" th:each="review : ${reviews}">

      <div class="d-flex justify-content-between align-items-center">

        <div>
          <strong th:text="${review.member.username}">ì‘ì„±ì</strong>
          <span class="text-warning ms-2">
                        â˜… <span th:text="${review.rating}"></span> / 5
                    </span>
        </div>

        <!-- ë¦¬ë·° ì‚­ì œ -->
        <form th:if="${review.member.username == currentUser}"
              th:action="@{/products/{id}/reviews/{reviewId}(id=${product.id}, reviewId=${review.id})}"
              method="post"
              onsubmit="return confirm('ë¦¬ë·°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
          <button class="review-delete-btn">ì‚­ì œ</button>
        </form>
      </div>

      <!-- ë¦¬ë·° ë‚´ìš© -->
      <p class="mt-2" th:text="${review.content}"></p>

      <!-- ë¦¬ë·° ì´ë¯¸ì§€ -->
      <div class="mt-2">
        <img th:if="${review.imagePath != null}"
             th:src="${review.imagePath}"
             class="img-fluid rounded"
             style="max-width:300px;">
      </div>

      <small class="text-muted"
             th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd HH:mm')}"></small>


      <!-- ëŒ“ê¸€ ëª©ë¡ -->
      <div class="mt-3 ps-3 border-start">

        <h6 class="fw-bold">ğŸ’¬ ëŒ“ê¸€</h6>

        <div th:each="comment : ${review.comments}">
          <div class="mt-2">
            <strong th:text="${comment.member.username}"></strong>
            <span class="text-muted small ms-2"
                  th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span>

            <p class="mt-1" th:text="${comment.content}"></p>
          </div>
        </div>

        <!-- ëŒ“ê¸€ ì‘ì„± -->
        <form class="mt-2"
              th:action="@{/products/{productId}/reviews/{reviewId}/comment(
                            productId=${product.id},
                            reviewId=${review.id})}"
              method="post">

          <div class="input-group">
            <input type="text" name="content" class="form-control"
                   placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." required>
            <button class="btn btn-outline-primary">ë“±ë¡</button>
          </div>
        </form>
      </div>

    </div> <!-- ë¦¬ë·° 1ê°œ ë -->

  </div>
</div>


<!-- í›„ê¸° ì‘ì„± í¼ -->
<div class="card">
  <div class="card-header">í›„ê¸° ì‘ì„±í•˜ê¸°</div>
  <div class="card-body">

    <form th:action="@{/products/{id}/reviews(id=${product.id})}"
          method="post"
          enctype="multipart/form-data">

      <label class="form-label">í‰ì </label>
      <select name="rating" class="form-select mb-3" required>
        <option value="">í‰ì ì„ ì„ íƒí•˜ì„¸ìš”</option>
        <option value="5">â˜…â˜…â˜…â˜…â˜…</option>
        <option value="4">â˜…â˜…â˜…â˜…â˜†</option>
        <option value="3">â˜…â˜…â˜…â˜†â˜†</option>
        <option value="2">â˜…â˜…â˜†â˜†â˜†</option>
        <option value="1">â˜…â˜†â˜†â˜†â˜†</option>
      </select>

      <label class="form-label">í›„ê¸° ë‚´ìš©</label>
      <textarea name="content" class="form-control mb-3" rows="3" required></textarea>

      <label class="form-label">ì‚¬ì§„ (ì„ íƒ)</label>
      <input type="file" name="imageFile" class="form-control mb-3" accept="image/*">

      <button type="submit" class="btn btn-primary w-100">í›„ê¸° ë“±ë¡</button>

    </form>

  </div>
</div>

</body>
</html>
