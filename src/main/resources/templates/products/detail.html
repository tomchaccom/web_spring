<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title th:text="${product.name}">상품 상세</title>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

  <style>
    /* ⭐ 상품 이미지 고정 사이즈 */
    .product-image-fixed {
      width: 100%;
      height: 350px;          /* 이미지 높이 통일 */
      object-fit: cover;      /* 이미지 비율 유지 + 영역 채움 */
      border-radius: 10px;
      border: 1px solid #ddd;
    }

    /* ⭐ 리뷰 삭제 버튼 오른쪽 정렬 */
    .review-delete-btn {
      border: none;
      background: #dc3545;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.8rem;
    }

    .review-delete-btn:hover {
      background: #bb2d3b;
    }
  </style>

</head>

<body class="container mt-5">

<h1 class="mb-4" th:text="${product.name}">상품명</h1>

<div class="row">

  <!-- 상품 이미지 -->
  <div class="col-md-5">
    <img th:src="${product.imageUrl}"
         class="product-image-fixed"
         alt="상품 이미지">
  </div>

  <!-- 상품 정보 -->
  <div class="col-md-7">

    <h3 class="text-primary"
        th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')} + '원'">
    </h3>

    <div class="mt-4">
      <h5 class="fw-bold">상품 설명</h5>
      <p class="border rounded p-3 bg-light"
         th:text="${product.description}">
      </p>
    </div>

    <p class="mt-3">
      <strong>재고:</strong>
      <span th:text="${product.stock}"></span> 개
    </p>

    <p class="mt-2">
      <strong>카테고리:</strong>
      <span th:text="${product.category.name}"></span>
    </p>

    <!-- 버튼 그룹 -->
    <div class="mt-4 d-flex gap-3 flex-wrap">

      <a th:href="@{/order}" class="btn btn-success btn-lg">
        🧾 주문하기
      </a>

      <!-- 장바구니 -->
      <form th:action="@{/cart/add/{id}(id=${product.id})}" method="post">
        <button type="submit" class="btn btn-warning btn-lg text-white">
          🛒 장바구니 담기
        </button>
      </form>

      <!-- 위시리스트 -->
      <form th:action="@{/products/wish(id=${product.id})}" method="post">
        <button type="submit" class="btn btn-outline-danger btn-lg">
          ❤️ 위시리스트에 추가
        </button>
      </form>


      <a href="/wish" class="btn btn-outline-secondary btn-lg">
        👉 내 위시리스트로 이동
      </a>

      <a href="/products" class="btn btn-secondary btn-lg">
        목록으로
      </a>

    </div>
  </div>
</div>


<!-- ========================================================= -->
<!-- ⭐⭐⭐ 리뷰 리스트 영역 ⭐⭐⭐ -->
<!-- ========================================================= -->
<div class="mt-5">
  <h3 class="mb-3">📝 상품 후기</h3>

  <div class="list-group mb-4">

    <div class="list-group-item" th:each="review : ${reviews}">
      <div class="d-flex justify-content-between align-items-center">

        <div>
          <strong th:text="${review.member.username}">작성자</strong>
          <span class="text-warning ms-2">
                        ★ <span th:text="${review.rating}"></span> / 5
                    </span>
        </div>

        <!-- 🔥 본인 리뷰일 때만 삭제 -->
        <form th:if="${review.member.username == currentUser}"
              th:action="@{/products/{id}/reviews/{reviewId}(id=${product.id}, reviewId=${review.id})}"
              method="post"
              onsubmit="return confirm('리뷰를 삭제하시겠습니까?');">
          <button class="review-delete-btn">삭제</button>
        </form>

      </div>

      <p class="mt-2" th:text="${review.content}"></p>
      <small class="text-muted"
             th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd HH:mm')}"></small>
    </div>

  </div>


  <!-- ========================================================= -->
  <!-- ⭐⭐⭐ 리뷰 작성 폼 ⭐⭐⭐ -->
  <!-- ========================================================= -->
  <div class="card">
    <div class="card-header">후기 작성하기</div>
    <div class="card-body">

      <form th:action="@{/products/{id}/reviews(id=${product.id})}" method="post">

        <label class="form-label">평점</label>
        <select name="rating" class="form-select mb-3" required>
          <option value="">평점을 선택하세요</option>
          <option value="5">★★★★★</option>
          <option value="4">★★★★☆</option>
          <option value="3">★★★☆☆</option>
          <option value="2">★★☆☆☆</option>
          <option value="1">★☆☆☆☆</option>
        </select>

        <label class="form-label">후기 내용</label>
        <textarea name="content" class="form-control mb-3" rows="3" required></textarea>

        <button type="submit" class="btn btn-primary w-100">
          후기 등록
        </button>



      </form>

    </div>
  </div>

</div>

</body>
</html>
