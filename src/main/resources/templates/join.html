<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원가입</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body class="bg-light">

<header class="bg-primary text-white text-center py-3">
    <h1>쇼핑몰 회원가입</h1>
</header>

<main class="container my-5">
    <div class="card shadow-sm">
        <div class="card-body">
            <form th:action="@{/join}" th:object="${memberJoinDto}" method="post" id="joinForm">

                <!-- 약관 동의 영역 -->
                <h4 class="mb-3">1. 서비스 이용 약관 동의</h4>

                <!-- 전체 동의 -->
                <div class="form-check mb-3">
                    <input type="checkbox" id="agreeAll" class="form-check-input">
                    <label for="agreeAll" class="form-check-label fw-bold">
                        전체 약관에 동의합니다 (선택 포함)
                    </label>
                </div>

                <hr>

                <!-- 필수 약관 -->
                <div class="form-check d-flex align-items-center justify-content-between mb-2">
                    <div>
                        <input type="checkbox" id="agreeService" name="agreeService" required class="form-check-input agree-check">
                        <label for="agreeService" class="form-check-label">[필수] 이용 약관 동의</label>
                    </div>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="showTerms('service')">전문 보기</button>
                </div>

                <div class="form-check d-flex align-items-center justify-content-between mb-2">
                    <div>
                        <input type="checkbox" id="agreePrivacy" name="agreePrivacy" required class="form-check-input agree-check">
                        <label for="agreePrivacy" class="form-check-label">[필수] 개인정보 수집 및 이용 동의</label>
                    </div>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="showTerms('privacy')">전문 보기</button>
                </div>

                <!-- 선택 약관 -->
                <div class="form-check d-flex align-items-center justify-content-between mb-2">
                    <div>
                        <input type="checkbox" id="agreeMarketing" name="agreeMarketing" class="form-check-input agree-check">
                        <label for="agreeMarketing" class="form-check-label">[선택] 마케팅 정보 수신 동의</label>
                    </div>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="showTerms('marketing')">전문 보기</button>
                </div>

                <div class="form-check mb-4">
                    <input type="checkbox" id="agreeSms" name="agreeSms" class="form-check-input agree-check">
                    <label for="agreeSms" class="form-check-label">[선택] SMS 수신 동의</label>
                </div>

                <hr>

                <!-- 회원 정보 입력 -->
                <h4 class="mb-3">2. 회원 정보 입력</h4>

                <div class="mb-3">
                    <label for="username" class="form-label">아이디 (ID) *</label>
                    <div class="input-group">
                        <input type="text" id="username" class="form-control" th:field="*{username}" required>
                        <button type="button" class="btn btn-outline-primary" onclick="checkDuplicate()">중복 확인</button>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="password" class="form-label">비밀번호 *</label>
                    <input type="password" id="password" class="form-control" th:field="*{password}" required>
                </div>

                <div class="mb-3">
                    <label for="passwordConfirm" class="form-label">비밀번호 확인 *</label>
                    <input type="password" id="passwordConfirm" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="email" class="form-label">이메일 *</label>
                    <input type="email" id="email" class="form-control" th:field="*{email}" required>
                </div>

                <div class="mb-3">
                    <label for="phone" class="form-label">휴대폰 번호</label>
                    <input type="tel" id="phone" class="form-control" th:field="*{phone}">
                </div>

                <div id="agreement-message" class="text-danger mb-3">
                    필수 약관에 동의해야 가입할 수 있습니다.
                </div>

                <button type="submit" class="btn btn-primary w-100 submit-button" disabled>
                    회원가입
                </button>

            </form>
        </div>
    </div>
</main>

<footer class="text-center py-3 text-muted">
    &copy; 2025 Shopping Mall
</footer>

<script>
    // 전체 체크 및 약관 체크 로직
    const agreeAll = document.getElementById('agreeAll');
    const allCheckboxes = document.querySelectorAll('.agree-check');
    const requiredCheckboxes = document.querySelectorAll('.agree-check[required]');
    const submitButton = document.querySelector('.submit-button');
    const agreementMessage = document.getElementById('agreement-message');

    // 전체 체크 → 개별 체크로 전파
    agreeAll.addEventListener('change', function () {
        allCheckboxes.forEach(cb => cb.checked = agreeAll.checked);
        checkAgreementStatus();
    });

    // 개별 체크 → 전체 체크 상태 업데이트
    allCheckboxes.forEach(cb => {
        cb.addEventListener('change', () => {
            const allChecked = Array.from(allCheckboxes).every(c => c.checked);
            agreeAll.checked = allChecked;
            checkAgreementStatus();
        });
    });

    // 필수 약관 체크 여부에 따라 버튼 활성화
    function checkAgreementStatus() {
        const requiredAgreed = Array.from(requiredCheckboxes).every(c => c.checked);

        if (requiredAgreed) {
            submitButton.disabled = false;
            agreementMessage.style.display = 'none';
        } else {
            submitButton.disabled = true;
            agreementMessage.style.display = 'block';
        }
    }

    checkAgreementStatus();

    function checkDuplicate() {
        alert("ID 중복 확인 기능 (API 필요)");
    }

    function showTerms(type) {
        alert(type.toUpperCase() + " 약관 전문을 표시합니다.");
    }
</script>

</body>
</html>
